
<section class="content">
  <div class="row">
    <ol class="breadcrumb">
      <li>
        <a class="text-black" routerLink="/business/business-management/dash-board">Trang chủ</a>
      </li>
      <li>
        <a class="text-black">Hệ thống</a>
      </li>
      <li>
        <a>Nhóm quyền</a>
      </li>
    </ol>
    <button class="btn btn-sm btn-previous pull-right" appSvBackButton><i class="far fa-undo-alt"></i> Quay lại</button>
  </div>
  <div class="col-xs-12 no-padding">
    <div class="panel panel-default">
      <div class="panel-heading">
        <div class="row">
          <div class="col-md-offset-4 col-md-8 panel-heading-group">
            <div class="form-row">
              <div class="search-item">
                <input class="form-control" [(ngModel)]="tenNhom" (keydown.enter)="dataStateChange()" type="text" placeholder="Tên nhóm..." />
              </div>
              <div class="search-item">
                <input class="form-control" [(ngModel)]="maNhom" (keydown.enter)="dataStateChange()" type="text" placeholder="Mã nhóm..." />
              </div>
              <div class="search-item">
                <ng-select [items]="lstTrangThai" placeholder="Trạng thái ..."
                           bindLabel="text" bindValue="value"
                           [(ngModel)]="TrangThai"
                           [closeOnSelect]="true"
                           (change)="dataStateChange()">
                  <ng-template ng-option-tmp let-item="item">
                    <div title="{{item.text}}">{{item.text}}</div>
                  </ng-template>
                </ng-select>
              </div>
              <div>
                <button class="btn btn-primary btn-sm" (click)="dataStateChange()">
                  <i class="fal fa-search"></i>
                </button>
              </div>
            </div>
            <div class="btn-b-l">
              <button class="btn btn-sm btn-primary" [routerLink]="['./create-group-user', departmentId]">
                <i class="fal fa-plus"></i> Thêm mới
              </button>
            </div>
          </div>
        </div>
      </div>
      <p-table #table [value]="groupuserlst" [lazy]="true" (onLazyLoad)="onPageChange($event)" [paginator]="true" [rows]="pagesize" [totalRecords]="totalRecords" [rowsPerPageOptions]="[10,20,30]" [responsive]="true" autoLayout="true" [showCurrentPageReport]="true" currentPageReportTemplate="Tổng số {{totalRecords}}">
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 50px">
              STT
            </th>
            <th style="width: 140px">
              Mã nhóm
            </th>
            <th>
              Tên nhóm
            </th>
            <th style="width: 120px">
              Số người dùng
            </th>
            <th style="width: 120px">
              Trạng thái
            </th>
            <th style="width: 120px">Hành động</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowIndex="rowIndex" let-grpuser>
          <tr>
            <td class="text-center">{{rowIndex + 1}}</td>
            <td class="text-center">
              <a [routerLink]="['./view-group-user', grpuser.ma]" title="Xem chi tiết">{{grpuser.maNhom}}</a>
            </td>
            <td>
              <span class="line-clamp-2" style="-webkit-box-orient: vertical">{{grpuser.tenNhom}}</span>
            </td>
            <td class="text-center">
              {{grpuser.soNguoiDung}}
            </td>
            <td class="text-center">
              <label>
                <input id="id-pills-stacked" type="checkbox" [(ngModel)]="grpuser.trangThai" (change)="UpdateStatus(item)" class="ace ace-switch ace-switch-4">
                <span class="lbl middle"></span>
              </label>
            </td>
            <td class="text-center">
              <a *hasPermission="['3', 'A_III_2']" title="Sửa" [routerLink]="['./update-group-user', grpuser.ma] ">
                <i class="far fa-pen"></i>
              </a>
              <a *hasPermission="['3', 'A_III_4']" title="Xóa" (appConfirmClick)="preDelete(grpuser.ma)">
                <i class="far fa-trash"></i>
              </a>
              <a *ngIf="grpuser.trangThai" title="Thêm người dùng" data-toggle="modal" data-target="#addUserToGroupModal" (click)=getListUserByGroupId(grpuser.ma)>
                <i *hasPermission="['3','A_III_5']" class="fal fa-user-plus"></i>
              </a>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6">
              Không tìm thấy dữ liệu
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</section>

<div class="modal fade no-padding" id="addUserToGroupModal" tabindex="1">
  <div class="modal-dialog" style="width:70%">
    <div class="panel panel-default">
      <div class="modal-header">
        <button class="close btn-close-modal" data-dismiss="modal">
          ×
        </button>
        <p class="title-ct no-margin">Danh sách người dùng</p>
      </div>
      <div class="modal-body">
        <div class="row form-group form-horizontal">
          <div class="col-md-2 control-label">Chọn người dùng:</div>
          <div class="col-md-8">
            <div class="input-group">
              <select id="addusertogroup" class="form-control select2 select2-hidden-accessible" multiple="" style="width: 100%;" tabindex="-1" aria-hidden="true">
                <option *ngFor="let sp of listUserToAdd" value="{{sp.ma}}">{{sp.hoTen}}</option>
              </select>
            </div>
          </div>
          <div class="col-md-2">
            <button *hasPermission="['3','A_III_6']" class="btn btn-primary btn-sm btn-block pull-right" (click)="addUserToGroup()">
              <i class="fal fa-plus"></i> Thêm
            </button>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-12">
            <div class="table-responsive">
              <table class="table table-bordered table-hover">
                <thead>
                  <tr class="info">
                    <th class="text-center">Tên Người Dùng</th>
                    <th class="text-center">Tên Đăng Nhập</th>
                    <th class="text-center">Trạng Thái</th>
                    <th *hasPermission="['3','A_III_7']" class="text-center">Chức Năng </th>
                  </tr>
                </thead>

                <tr *ngFor="let sp of lstUserGroupUser;let i = index">
                  <td class="text-left">{{sp.hoTen}}</td>
                  <td class="text-left">{{sp.tenDangNhap}}</td>
                  <td class="text-left" *ngIf="sp.kichHoat">Đang sử dụng</td>
                  <td class="text-left" *ngIf="!sp.kichHoat">Không sử dụng</td>
                  <td class="text-center" *hasPermission="['3','A_III_7']">
                    <a class="btn btn-purple btn-xs" data-toggle="modal" (click)="confirmDeleteUserFromGroup(sp.ma)" title="Xóa">
                      <i class="far fa-trash"></i>
                    </a>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-sm btn-default" data-dismiss="modal">
          <i class="far fa-times"></i> Hủy
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" style="padding-top:15%" id="confirmModal" tabindex="-1">
  <div class="modal-dialog " style="width: 500px;">
    <div class="panel panel-default no-margin">
      <div class="panel-heading">
        <button type="button" class="close btn-close-moda pull-right" data-dismiss="modal" mat-dialog-close tabindex="8" style="color: white;font-size: 24px !important; opacity: 0.9;font-weight: 400;">
          ×
        </button>
        <p class="title-ct no-margin">Xác nhận</p>
      </div>
      <div class="modal-body">
        <span>
          Anh/chị có chắc chắn thực hiện hành động này?
        </span>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success btn-sm btn-confirm" (click)="preDeleteUserToGroup()"> Đồng ý</button>
        <button data-dismiss="modal" class="btn btn-default btn-sm btn-confirm">Hủy</button>
      </div>
    </div>
  </div>
</div>


<div class="content-body">
	<div class="container-fluid p-0">
		<div class="row">
			<div class="col-lg-12">
				<ol class="breadcrumb title-module px-0 bg-transparent mb-0">
					<!-- <li class="breadcrumb-item"><a>Vai trò</a></li> -->
					<li class="breadcrumb-item active"><a class="font-weight-bold">{{title}}</a></li>
				</ol>
				<div class="btn-group group-button-table" role="group">
					<a class="btn btn-sm btn-default rounded mr-3" style="border: 1px solid gray;" (click)="redirectList()">
						<i class="bi bi-arrow-left"></i>&nbsp;
						Quay lại
					</a>
					<button class="btn btn-sm grd-xanhngoc text-white rounded border-0 mr-3 px-4" (click)="onSave(false)">{{action}}</button>
					<button *hasPermission="['3', 'B_IV_4']" class="btn btn-sm grd-blue text-white rounded border-0 mr-3 px-4" (click)="onSave(true)">Gửi</button>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6" style="padding: 20px 20px 0px 40px; border-right: 1px solid #e5e5e5;">
				<form class="form-horizontal" [formGroup]="form">
					<div class="row form-group">
						<div class="col-sm-12 padding-col">
							<label class="control-label department">Tiêu đề<span class="text-danger">(*)</span></label>
							<input class="form-control" formControlName="title" [(ngModel)]="model.title" maxlength="100" placeholder="Nhập..." />
							<div *ngIf="(submitted && f.title.invalid) || (f.title.invalid && (f.title.dirty || f.title.touched))" class="has-error m-b-12">
								<div *ngIf="f.title.errors.required">
									<span class="help-block">Trường dữ liệu này không để trống</span>
								</div>
							</div>
						</div>

						<div class="col-sm-6 padding-col">
							<label class="control-label department">Thời gian bắt đầu<span class="text-danger">(*)</span></label>
							<mat-form-field appearance="outline" style="width: 100%;">
								<input matInput [ngxMatDatetimePicker]="startDate"
									placeholder="Chọn ngày" formControlName="startDate" [(ngModel)]="model.startDate"
								>
								<mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
								<ngx-mat-datetime-picker #startDate [showSpinners]="showSpinners" [showSeconds]="showSeconds"
									[stepHour]="stepHour" [stepMinute]="stepMinute"  [touchUi]="touchUi"
									[color]="color" [enableMeridian]="enableMeridian">
								</ngx-mat-datetime-picker>
							</mat-form-field>

							<div *ngIf="(submitted && f.startDate.invalid) || (f.startDate.invalid && (f.startDate.dirty || f.startDate.touched))" class="has-error">
							
								<div *ngIf="f.startDate.errors.required">
									<span class="help-block">Trường dữ liệu này không được để trống</span>
								</div>
								<div *ngIf="f.startDate.errors && !f.startDate.errors.required">
									<span class="help-block">Định dạng ngày không đúng</span>
								</div>

							</div>

						</div>
						<div class="col-sm-6 padding-col">
							<label class="control-label department">Thời gian kết thúc<span class="text-danger">(*)</span></label>
							
							<mat-form-field appearance="outline" style="width: 100%;">
									<input matInput [ngxMatDatetimePicker]="endDate"
										placeholder="Chọn ngày" formControlName="endDate" [(ngModel)]="model.endDate"
									>
								<mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
								<ngx-mat-datetime-picker #endDate [showSpinners]="showSpinners" [showSeconds]="showSeconds"
									[stepHour]="stepHour" [stepMinute]="stepMinute"  [touchUi]="touchUi"
									[color]="color" [enableMeridian]="enableMeridian">
								</ngx-mat-datetime-picker>
							</mat-form-field>
							<div *ngIf="(submitted && f.endDate.invalid) || (f.endDate.invalid && (f.endDate.dirty || f.endDate.touched))" class="has-error">
								<div *ngIf="f.endDate.errors.required">
									<span class="help-block">Trường dữ liệu này không được để trống</span>
								</div>
								<div *ngIf="f.endDate.errors && !f.endDate.errors.required">
									<span class="help-block">Định dạng ngày không đúng</span>
								</div>
							</div>

						</div>
						<div class="col-sm-12 padding-col">
							<label class="control-label department">Địa điểm <span class="text-danger">(*)</span></label>
							<input class="form-control" [(ngModel)]="model.place" formControlName="place" placeholder="Nhập..." />
							<div *ngIf="(submitted && f.place.invalid) || (f.place.invalid && (f.place.dirty || f.place.touched))" class="has-error m-b-12">
								<div *ngIf="f.place.errors">
									<span class="help-block">Trường dữ liệu này không để trống</span>
								</div>
							</div>
						</div>
						<div class="col-sm-12 padding-col">
							<label class="control-label department">Ghi chú</label>
							<input class="form-control" [(ngModel)]="model.note" formControlName="note" placeholder="Nhập..." />

						</div>
						<div class="col-sm-12 padding-col">
							<label class="control-label department">Nội dung <span class="text-danger">(*)</span></label>
							<textarea class="form-control" [(ngModel)]="model.content" formControlName="content" rows="6" placeholder="Nhập..."></textarea>
							<div *ngIf="(submitted && f.content.invalid) || (f.content.invalid && (f.content.dirty || f.content.touched))" class="has-error m-b-12">
								<div *ngIf="f.content.errors">
									<span class="help-block">Trường dữ liệu này không để trống</span>
								</div>
							</div>
						</div>
						<!-- tài liệu đính kèm -->
						<div class="col-12 attach-ct mt-3">
							<p class="h5 text-uppercase mb-3">
								<span>
									<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-paperclip" viewBox="0 0 16 16">
										<path
											d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z">
										</path>
									</svg>
								</span>
								Tài liệu đính kèm
							</p>
							<div class="attach-file row">
								<div class="col-2 mb-2" *ngIf="statusCurent != 2">
									<div class="alert alert-dark d-flex align-items-center h-80">
										<input type="file" style="display: none" #file id="file" (change)="onUpload($event)" class="inputfile inputfile-4 d-none" multiple
											accept="{{fileAccept}}" />
										<label for="file-5" (click)="file.click()" style="padding: 0px">
											<figure style="background-color: transparent; padding-left: 10px;">
												<i class="bi bi-file-earmark-arrow-up" style="font-size: 40px;"></i>
											</figure>
											<span class="d-block text-center" style="font-size: 15px;">Tải lên</span>
										</label>
									</div>
								</div>
								<ng-container *ngFor="let item of files">

									<div class="col-2 m-2 border-1" *ngIf="item.fileType == 1">
										<div class="alert alert-dark alert-dismissible fade show d-flex align-items-center h-90" style="margin-bottom: 0.3rem;">
											<button *ngIf="statusCurent != 2" type="button" (click)="onRemoveFile(item)" class="close" data-dismiss="alert"
												aria-label="Close"><span><i class="mdi mdi-close"></i></span>
											</button>
											<a href="#" class="d-block text-center">
												<img src="../../../../assets/dist/images/file-word.svg" style="width: 45px" alt="">
												<span class="mt-2 text-dark text-wrap text-2line">{{item.name}}</span>
											</a>
										</div>
									</div>

									<div class="col-2 m-2 border-1" *ngIf="item.fileType == 3">
										<div class="alert alert-dark alert-dismissible fade show d-flex align-items-center h-90" style="margin-bottom: 0.3rem;">
											<button type="button" *ngIf="statusCurent != 2" (click)="onRemoveFile(item)" class="close" data-dismiss="alert"
												aria-label="Close"><span><i class="mdi mdi-close"></i></span>
											</button>
											<a href="#" class="d-block text-center">
												<img src="../../../../assets/dist/images/file-pdf.svg" style="width: 45px" alt="">
												<span class="mt-2 text-dark text-wrap text-2line">{{item.name}}</span>
											</a>
										</div>
									</div>

									<div class="col-2 m-2 border-1" *ngIf="item.fileType == 4">
										<div class="alert alert-dark alert-dismissible fade show d-flex align-items-center h-90" style="margin-bottom: 0.3rem;">
											<button type="button" *ngIf="statusCurent != 2" (click)="onRemoveFile(item)" class="close" (click)="onRemoveFile(item)"><span><i
														class="mdi mdi-close"></i></span>
											</button>
											<a href="#" class="d-block text-center box-fileinput">
												<img src="../../../../assets/dist/images/file-image.svg" style="width: 45px" alt="">
												<span class="mt-2 text-dark text-wrap text-2line">{{item.name}}</span>
											</a>
										</div>
									</div>

									<div class="col-2 m-2 border-1" *ngIf="item.fileType == 2">
										<div class="alert alert-dark alert-dismissible fade show d-flex align-items-center h-90" style="margin-bottom: 0.3rem;">
											<button type="button" *ngIf="statusCurent != 2" (click)="onRemoveFile(item)" class="close" data-dismiss="alert"
												aria-label="Close"><span><i class="mdi mdi-close"></i></span>
											</button>
											<a href="#" class="d-block text-center">
												<img src="../../../../assets/dist/images/file-excel.svg" style="width: 45px" alt="">
												<span class="mt-2 text-dark text-wrap text-2line">{{item.name}}</span>
											</a>
										</div>
									</div>
									<div class="col-2 m-2 border-1" *ngIf="item.fileType == 6">
										<div class="alert alert-dark alert-dismissible fade show d-flex align-items-center h-90" style="margin-bottom: 0.3rem;">
											<button type="button" *ngIf="statusCurent != 2" (click)="onRemoveFile(item)" class="close" data-dismiss="alert"
												aria-label="Close"><span><i class="mdi mdi-close"></i></span>
											</button>
											<a href="#" class="d-block text-center">
												<img src="../../../../assets/dist/images/file-powerpoint.svg" style="width: 45px" alt="">
												<span class="mt-2 text-dark text-wrap text-2line">{{item.name}}</span>
											</a>
										</div>
									</div>
								</ng-container>
							</div>
						</div>

					</div>
				</form>
			</div>
			<div class="col-md-6">
				<form class="form-horizontal" [formGroup]="form">
					<div class="row form-group" style="padding-right: 10px;">
						<div class="col-sm-12" style="padding: 0px 12px;">
							<div class="title-user-map">Thành phần tham dự</div>
							<div class="search-user" *ngIf="statusCurent != 2">
								<div class="department">Họ và tên</div>
								<div class="" style="display: flex;">
									<div class="input-serach center" style="width: 60%;">

										<div class="form-group" style="margin-bottom: 0px; width: 100%;">
											<ngx-dropdown-treeview [config]="config" [items]="items" buttonClass="btn btn-outline-primary"
												(selectedChange)="onSelectedChange($event)" (filterChange)="onFilterChange($event)">
											</ngx-dropdown-treeview>
										</div>

									</div>
									<div style="width: 35%; display: flex;" class="center">
										<div class="form-check" style="margin: 5px;">
											<input class="form-check-input" type="checkbox" [(ngModel)]="sendSMS" formControlName="sendSMS" id="sendSMS">
											<label class="form-check-label" for="sendSMS">
												Gửi SMS
											</label>
										</div>
										<div class="form-check" style="margin: 5px;">
											<input class="form-check-input" type="checkbox" [(ngModel)]="sendEmail" formControlName="sendEmail" id="sendMail">
											<label class="form-check-label" for="sendMail">
												Gửi mail
											</label>
										</div>
									</div>
									<div class="action padding-item center">
										<button type="button" style="width: 40px; height: 40px;" class="btn grd-blue btn-block border-0 px-3 text-white center"
											(click)="onCreateUser()">
											<i class="bi bi-person-plus"></i>
										</button>
									</div>
								</div>
							</div>

						</div>


						<div class="list-user">
							<div class="title-user-map center" style="text-transform: none;" *ngIf="listItemUserSelected.length ==0">Chưa có thành phần tham dự</div>
							<div class="col-sm-12 item-user" *ngFor="let item of listItemUserSelected">
								<div class="info-user border-right padding-item" style="display: flex; padding-left: 0px;">
									<span *ngIf="item.avatar == ''" class="no-avatar-view" style="width: 40px; height: 40px;">
										<svg width="36" height="36" viewBox="0 0 78 78" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path fill-rule="evenodd" clip-rule="evenodd"
												d="M6.5 78C6.5 78 0 78 0 71.5C0 65 6.5 45.5 39 45.5C71.5 45.5 78 65 78 71.5C78 78 71.5 78 71.5 78H6.5ZM39 39C44.1717 39 49.1316 36.9455 52.7886 33.2886C56.4455 29.6316 58.5 24.6717 58.5 19.5C58.5 14.3283 56.4455 9.36838 52.7886 5.71142C49.1316 2.05446 44.1717 0 39 0C33.8283 0 28.8684 2.05446 25.2114 5.71142C21.5545 9.36838 19.5 14.3283 19.5 19.5C19.5 24.6717 21.5545 29.6316 25.2114 33.2886C28.8684 36.9455 33.8283 39 39 39Z"
												fill="#743F15" />
										</svg>
									</span>
									<img *ngIf="item.avatar !=''" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; margin-right: 5px;" src="{{item.avatar}}"
										alt="">
									<div>
										<div class="title">{{item.fullName}}</div>
										<div class="department">{{item.positionName}}</div>
									</div>
								</div>
								<div class="info-unit border-right padding-item" style="width: 40%">
									<div class="title">Đơn vị</div>
									<div class="department">{{item.unitName}}</div>
								</div>
								<div class="type-send border-right padding-item">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" [checked]="item.sendSMS == true" (click)="onUpdateUser(item.userId, true)">
										<label class="form-check-label">
											Gửi SMS
										</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox" [checked]="item.sendEmail == true" (click)="onUpdateUser(item.userId, false)">
										<label class="form-check-label">
											Gửi mail
										</label>
									</div>
								</div>
								<div class="action padding-item center" *ngIf="statusCurent != 2">
									<button type="button" style="width: 40px; height: 40px; background: #E0E7FA; color: black;" class="btn btn-block border-0 px-3 center"
										(click)="onRemoveUser(item)">
										<i class="bi bi-person-dash"></i>
									</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
	integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css"
	rel="stylesheet" /> -->
<div class="content-body">
	<div class="container-fluid p-0">
		<div class="">
			<div class="">
				<div class="card mb-0 shadow-none p-2">
					<div class="d-flex">
						<div class="px-2 align-center">
							<div class="h5 mb-0">Tìm kiếm</div>
						</div>

						<div class="form-group mb-0 px-2 align-center">
							<input type="text" class="form-control form-control-sm" placeholder="Nhập tên phòng .."
								[(ngModel)]="roomTitle" (keydown.enter)="fetchRooms()">
						</div>
						<div class="form-group mb-0 px-2 ps-relative">
							<input class="form-control-sm form-control" type="text" bsDatepicker #nv="bsDatepicker"
								[maxDate]="currentDate" [(ngModel)]="createDate" [bsConfig]="{
								adaptivePosition: true,
								dateInputFormat: 'DD/MM/YYYY',
								containerClass: 'theme-dark-blue'
							}" datetime="DD/MM/YYYY" placeholder="Chọn ngày" (bsValueChange)="dateValueChange($event)" />
							<span class="input-group-addon" (click)="nv.toggle()" [attr.aria-expanded]="nv.isOpen">
								<i class="fal fa-calendar"></i>
							</span>
						</div>
						<!-- <div class="px-2 align-center">
							<button class="btn btn-sm rounded border-0 text-white" style="background: #2E73D5;"
								(click)="fetchRooms()"> Tìm
								kiếm</button>
						</div> -->
					</div>
				</div>
			</div>
		</div>
		<!-- (bsValueChange)="dateValueChange($event)" -->



		<div class="content" role="main">
			<div class="chatbox">
				<div class="d-flex">
					<div class="card mb-sm-3 mb-md-0 contacts_card dz-chat-user-box">
						<div class="card-header chat-list-header text-center">
							<div>
								<h6 class="mb-1">Danh sách chat</h6>
							</div>
						</div>
						<div class="card-body contacts_body p-0">
							<ul class="contacts">
								<li *ngFor="let room of rooms" class="dz-chat-user"
									(click)="resetGetMessage(room.id,room.name,room.type)"
									[ngClass]="{'room-selected' : room.id == roomActive}">
									<div class="d-flex">
										<div class="img_cont">
											<i class="bi bi-person-fill cl-brown" style="font-size: 24px"></i>
										</div>
										<div class="user_info" style="flex: 1 1 0;">
											<span [ngClass]="{'text-white' : room.id == roomActive}">{{ room.title }}</span>
											<p>{{ room.createdDate | date:'dd/MM/yyyy HH:mm' }}</p>
										</div>
										<div *ngIf="room.type == 2" class="square mr-1 bg-red"></div>
									</div>
								</li>
							</ul>
						</div>
					</div>
					<div class="card chat dz-chat-history-box">
						<div class="card-header chat-list-header text-center">
							<div>
								<h6 class="mb-1">Tin nhắn</h6>
							</div>

							<mat-slide-toggle class="example-margin" [checked]="botEnable" color="primary"
								(change)="changeRoomStatus()">
								Bật bot
							</mat-slide-toggle>

						</div>
						<div #boxChat class="card-body msg_card_body" [scrollTop]="boxChat.scrollHeight"
							(scroll)="onScrollBoxChat($event)">
							<ng-container *ngFor="let message of messages">
								<div *ngIf="message.fromUserId != userId">
									<div class="mt-0">
										{{message.fromFullName}}
									</div>
									<div class="d-flex justify-content-start mb-2">
										<div class="img_cont_msg">
											<img *ngIf="!message.fromAvatar" src="../../../assets/dist/images/Icon_app.png"
												class="rounded-circle user_img_msg">
											<img *ngIf="message.fromAvatar" [src]="message.fromAvatar" class="rounded-circle user_img_msg">

										</div>
										<ng-container *ngIf="message.type == 'File'">
											<div class="msg_cotainer" style="max-width: 80%;">
												<a title="tải xuống" *ngFor="let item of message.messageContent"
													class="text-white cursor d-flex" style="text-decoration: underline;"
													(click)="DownloadFile(item)">
													{{item.Name}}
												</a>
												<span class="msg_time">{{message.dateSend | date:'HH:mm:ss dd/MM/yyyy'}}</span>
											</div>
										</ng-container>
										<ng-container *ngIf="message.type != 'File'">
											<div class="msg_cotainer" style="max-width: 80%;">
												{{message.messageContent}}
												<ng-container *ngIf="message.answers.length == 1">
													<ng-container *ngFor="let ans of message.answers">
														<div *ngIf="ans.answer" class="msg_cotainer_answer" [innerHTML]="ans.answer | Change">
															<!-- {{ans.answer}} -->
														</div>
														<ng-container *ngFor="let tag of ans.subTags.data">
															<div *ngIf="tag.title" class="msg_cotainer_child" (click)="sendMessage(tag,true)">
																{{tag.title}}
															</div>
														</ng-container>
													</ng-container>
												</ng-container>
												<ng-container *ngIf="message.answers.length > 1">
													<p-carousel [value]="message.answers" [numVisible]="1" [numScroll]="1" [circular]="false">
														<ng-template let-ans pTemplate="item">
															<div *ngIf="ans.answer" class="msg_cotainer_answer slide"
																[innerHTML]="ans.answer | Change">
																<!-- {{ans.answer}} -->
															</div>
															<ng-container *ngFor="let tag of ans.subTags.data">
																<div *ngIf="tag.title" class="msg_cotainer_child" (click)="sendMessage(tag,true)">
																	{{tag.title}}
																</div>
															</ng-container>
														</ng-template>
													</p-carousel>
												</ng-container>
												<span class="msg_time">{{message.dateSend | date:'HH:mm:ss dd/MM/yyyy'}}</span>
											</div>
										</ng-container>

									</div>
								</div>
								<div *ngIf="message.fromUserId == userId">
									<div class="mt-0" style="text-align:right;">
										{{message.fromFullName}}
									</div>
									<div class="d-flex justify-content-end mb-2">
										<ng-container *ngIf="message.type == 'File'">
											<div class="msg_cotainer_send" style="max-width: 80%;">
												<a title="tải xuống" *ngFor="let item of message.messageContent" class="text-dark cursor d-flex"
													style="text-decoration: underline;" (click)="DownloadFile(item)">
													{{item.Name}}
												</a>
												<span class="msg_time">{{message.dateSend | date:'HH:mm:ss dd/MM/yyyy'}}</span>
											</div>
										</ng-container>
										<ng-container *ngIf="message.type != 'File'">
											<div class="msg_cotainer_send" style="max-width: 80%;">
												{{message.messageContent}}
												<ng-container *ngFor="let tag of message.SubTags">
													<div *ngIf="tag.title" class="msg_cotainer_child">
														<span class="item p-2">{{tag.title}}</span>
													</div>
													<a *ngIf="tag.link" routerLink="tag.link">
														{{tag.link}}
													</a>
												</ng-container>
												<span class="msg_time_send">{{message.dateSend | date:'HH:mm:ss dd/MM/yyyy'}}</span>
											</div>
										</ng-container>

										<div class="img_cont_msg">
											<img *ngIf="!message.fromAvatar" src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg"
												class="rounded-circle user_img_msg">
											<img *ngIf="message.fromAvatar" [src]="message.fromAvatar" class="rounded-circle user_img_msg">
										</div>
									</div>
								</div>

							</ng-container>
						</div>
						<div class="card-footer pr-1 p-3">
							<input type="file" hidden #file id="file" (change)="onUpload($event)" class="inputfile inputfile-4 d-none"
								multiple />
							<div class="input-group br-textMessage p-1">
								<textarea id="type_msg" class="form-control" placeholder="Nhập nội dung.." name="newMessage"
									[(ngModel)]="newMessage" (keydown.enter)="onKeyDown()"></textarea>
								<button class="btn btn-sm btn-voice p-0 ml-2" svVoice [target]="'type_msg'">
									<img style="width: 30px;" src="assets/dist/img/app-images/mic.gif">
								</button>
								<div class="input-group-append" type="button" (click)="file.click()">
									<button type="button" class="btn cl-blue p-2"><i class="bi bi-plus-circle"></i></button>
								</div>


							</div>

							<div>
								<div *ngFor="let file of files; let i = index" class="m-1 p-1 border br-8px d-inline-block">
									<a *ngIf="file.fileType == 1" class="pointer" title="Xem file" style="color: #333; width:auto;">
										<img src="../../../../assets/dist/images/file-word.svg" class="mr-1" style="width: 15px" alt="">
										<span class="small text-truncate">{{file.name.length > 35? file.name.slice(0,34) + ".." :
											file.name}}</span>
									</a>
									<a *ngIf="file.fileType == 2" class="pointer" title="Xem file" style="color: #333; width:auto;">
										<img src="../../../../assets/dist/images/file-excel.svg" class="mr-1" style="width: 15px" alt="">
										<span class="small text-truncate">{{file.name.length > 35? file.name.slice(0,34) + ".." :
											file.name}}</span>
									</a>
									<a *ngIf="file.fileType == 3" class="pointer" title="Xem file" style="color: #333; width:auto;">
										<img src="../../../../assets/dist/images/file-pdf.svg" class="mr-1" style="width: 15px" alt="">
										<span class="small text-truncate">{{file.name.length > 35? file.name.slice(0,34) + ".." :
											file.name}}</span>
									</a>
									<a *ngIf="file.fileType == 4" class="pointer" title="Xem file" style="color: #333; width:auto;">
										<img src="../../../../assets/dist/images/file-image.svg" class="mr-1" style="width: 15px" alt="">
										<span class="small text-truncate">{{file.name.length > 35? file.name.slice(0,34) + ".." :
											file.name}}</span>
									</a>
									<a *ngIf="file.fileType == 6" title="Xem file" style="color: #333;">
										<img src="../../../../assets/dist/images/file-powerpoint.svg" class="mr-1" style="width: 15px"
											alt="">
										<span class="small text-truncate">{{file.name.length > 35? file.name.slice(0,34) + ".." :
											file.name}}</span>
									</a>
									<a *ngIf="file.fileType == 7" class="pointer" title="Xem file" style="color: #333; width:auto;">
										<img src="../../../../assets/dist/images/mp4-svgrepo-com.svg" class="mr-1" style="width: 15px"
											alt="">
										<span class="small text-truncate">{{file.name.length > 35? file.name.slice(0,34) + ".." :
											file.name}}</span>
									</a>

									<i (click)="onRemoveFile(i)" class="ml-1 mdi mdi-close" style="font-size: 15px;"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="overlay-container">
	<div class="toast-bottom-right toast-container">
		<ng-container *ngFor="let item of roomsShow; let i = index">
			<div class="toast-error toast ng-trigger ng-trigger-flyInOut show" style="background: #3faf45;" *ngIf="i < 3">
				<button aria-label="Close" class="toast-close-button ng-tns-c8-2 ng-star-inserted" (click)="updateStatus(item)">
					<span class="ng-tns-c8-2" aria-hidden="true">×</span>
				</button>
				<div class="toast-title ng-star-inserted" aria-label="Bạn có một tin nhắn mới"
					(click)="updateStatus(item, true)"> Bạn có một tin nhắn mới </div>
				<div aria-live="polite" role="alertdialog" (click)="updateStatus(item, true)"
					class="toast-message ng-star-inserted" aria-label="">
					{{item.title}}
				</div>
				<p class="mb-0">{{item.createdDate | date:'dd/MM/yyyy HH:mm:ss'}}</p>
			</div>
		</ng-container>

	</div>
</div>